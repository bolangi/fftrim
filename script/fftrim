#!/usr/bin/env perl
package fftrim;
use 5.006;
use strict;
use warnings;
use Path::Tiny;
use autodie ':all';
use feature 'say';
use Cwd;
use App::fftrim;
use Getopt::Long::Descriptive;

our ($opt, $usage,
	$current_dir,
	$control,
	$control_file,
	$dotdir ,
	$profile,
	$fh,
	$encoding_params,
	%length,
	$framerate,
	$finaldir,
	@lines,
	$is_error,
);

use Getopt::Long::Descriptive;
($opt, $usage) = describe_options(
   '%c %o',
   [ 'in=s',			"input file(s)"],
   [ 'out=s',			"output file"],
   [ 'start=s',			"start time"],
   [ 'end=s',			"end time"],
   [ 'profile=s',       'merge ffmpeg options from named file in $HOME/.fftrim'],
   [ 'source-dir=s',  	"source directory (batch mode)" ],
   [ 'target-dir=s',	"destination directory (batch mode)" ],
   [ 'c',      			"make output files conform to source file frame rate" ],
   [ 'n',      			"simulate: show output commands but do not run them" ],
   [ 'm',      			"simulate: show output commands omitting file checks" ],
   [ 'help',   			"print usage message and exit" ],
 );
print($usage->text, 
	"\nNote that options --in, --out, --start --end are not compatible with batch mode\n"),
	exit if $opt->{help} or ! keys %$opt;

process_args();


__DATA__
# change the following ffmpeg arguments to suit
-c:v libx264
-preset:v medium
-profile:v main
-tune:v film
-s:v 640x360
-c:a aac
-b:a 80k
-ac 2
-ar 24000
-level 3

# don't change these arguments
-strict -2
# -copyts # causes problem rendering 20180923-2
